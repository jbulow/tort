#!/bin/sh
set -ex
(
cat "$1.begin"
cat ${LIB_CFILES} /dev/null | 
perl -ne '
if ( /^\s*[a-z0-9_]+.*\s+(_tort_m_([a-z0-9_]+?)__([a-z0-9_]+))\s*[(].*[)]\s*$/i ) { 
  print "  tort_add_method(tort__mt(", $2, "), \"", $3, "\", $1);\n";
}' | sort -u # | tee /dev/tty
cat "$1.end"
) > "$1"

